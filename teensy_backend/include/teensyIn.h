//---------------------------------------------------------------------------------------------------------------------------------------
// Header file for TeensyIn class
//
// Author: Matteo Cartiglia <camatteo@ini.uzh.ch>
// Last updated: 15 JUL 2022 (Ciara Giles-Doran <gciara@student.ethz.ch>)
//---------------------------------------------------------------------------------------------------------------------------------------

#ifndef TEENSYIN_H
#define TEENSYIN_H

#include <Arduino.h>

class TeensyIn 
{
    // ------------------------------------------ Declaring class constructor and public methods ----------------------------------------

    public:

    //-----------------------------------------------------------------------------------------------------------------------------------
    // Class constructor; initialises the TeensyIn object and sets up the relevant pins on Teensy
    //-----------------------------------------------------------------------------------------------------------------------------------
    TeensyIn(const int inputReqPin, const int inputAckPin, int inputDataPins[], int inputNumDataPins, byte inputBuffer[] = NULL, 
        int inputDelay = 0, bool inputActiveLow = false);

    //----------------------------------------------------------------------------------------------------------------------------------
    // dataRead: Executes REQ/ACK handshake and retrieves input from ALIVE
    //----------------------------------------------------------------------------------------------------------------------------------
    unsigned int dataRead();

    //----------------------------------------------------------------------------------------------------------------------------------
    // reqRead: Reads REQ pin state
    //----------------------------------------------------------------------------------------------------------------------------------    
    bool reqRead();

    //----------------------------------------------------------------------------------------------------------------------------------
    // ackWrite: Writes to ACK pin
    //----------------------------------------------------------------------------------------------------------------------------------
    void ackWrite(bool val);


    // ---------------------------------------------------- Declaring private methods --------------------------------------------------
    private:

    //----------------------------------------------------------------------------------------------------------------------------------
    // setupEncoderComms: Sets up the relevant pins for Encoder comms on Teensy
    //----------------------------------------------------------------------------------------------------------------------------------
    void setupEncoderComms();

    //----------------------------------------------------------------------------------------------------------------------------------
    // setupC2FComms: Sets up the relevant pins for C2F comms on Teensy
    //----------------------------------------------------------------------------------------------------------------------------------
    void setupC2FComms();

    //----------------------------------------------------------------------------------------------------------------------------------
    // getInputData: Retrieves input from ALIVE
    //----------------------------------------------------------------------------------------------------------------------------------
    unsigned int getInputData();


    // --------------------------------------------------- Declaring private variables -------------------------------------------------

    int _inputReqPin;
    int _inputAckPin;
    int* _inputDataPins;
    int _inputNumDataPins;
    byte* _inputBuffer;
    int _inputDelay;
    bool _inputActiveLow;

};

#endif